<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Operatørrunde</title>
    
    <link rel="icon" type="image/png" sizes="192x192" href="/android-chrome-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/android-chrome-512x512.png">
    <link rel="apple-touch-icon" href="/android-chrome-192x192.png">
    <meta name="theme-color" content="#ffffff">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Operatørrunde">
    
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/papaparse@5.3.0/papaparse.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body { background-color: #f9fafb; }
        button { min-height: 44px; }
        input[type="checkbox"] { width: 1.2rem; height: 1.2rem; }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 0.5rem;
            max-width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script>
        const Button = ({ children, onClick, className }) => 
            React.createElement('button', {
                onClick,
                className: `px-4 py-2 rounded text-white font-medium ${className}`
            }, children);

        const Modal = ({ isOpen, onClose, title, content }) => {
            if (!isOpen) return null;
            
            return React.createElement('div', { 
                className: 'modal-overlay',
                onClick: onClose
            },
                React.createElement('div', { 
                    className: 'modal-content',
                    onClick: e => e.stopPropagation()
                },
                    React.createElement('button', {
                        className: 'absolute top-2 right-2 text-gray-600 hover:text-gray-800 text-xl',
                        onClick: onClose
                    }, '×'),
                    React.createElement('h2', { 
                        className: 'text-xl font-bold mb-4' 
                    }, title),
                    React.createElement('div', { 
                        className: 'space-y-2' 
                    }, content)
                )
            );
        };

        const Checkbox = ({ id, checked, onChange, label, onInfoClick, hasInfo }) =>
            React.createElement('div', { className: 'flex items-start space-x-3 py-1' },
                React.createElement('input', {
                    type: 'checkbox',
                    id,
                    checked,
                    onChange: (e) => onChange(e.target.checked),
                    className: 'mt-1'
                }),
                React.createElement('label', {
                    htmlFor: id,
                    className: checked ? 'line-through text-gray-500 flex-grow' : 'text-gray-900 flex-grow'
                }, label),
                hasInfo && React.createElement('button', {
                    onClick: onInfoClick,
                    className: 'text-blue-600 hover:text-blue-800 text-sm px-2',
                }, 'Mer info')
            );

        const App = () => {
            const [tasks, setTasks] = React.useState(null);
            const [currentScreen, setCurrentScreen] = React.useState('welcome');
            const [selectedArea, setSelectedArea] = React.useState(null);
            const [isModalOpen, setIsModalOpen] = React.useState(false);
            const [modalContent, setModalContent] = React.useState({ title: '', content: '' });

            // Simulated task data with info content
            React.useEffect(() => {
                const savedTasks = localStorage.getItem('osebergTasks');
                if (savedTasks) {
                    setTasks(JSON.parse(savedTasks));
                    return;
                }

                // Simulated data - replace with actual CSV parsing
                const dummyTasks = {
                    'W21': {
                        'Pumper': [
                            {
                                id: 1,
                                description: 'Sjekk pumpe P-101',
                                completed: false,
                                info: {
                                    title: 'Pumpe P-101 Info',
                                    content: 'Kontroller for unormal støy og vibrasjon. Normal driftstemperatur er 50-60°C. Ved avvik, kontakt vedlikeholdsavdeling.'
                                }
                            },
                            {
                                id: 2,
                                description: 'Inspiser pumpe P-102',
                                completed: false,
                                info: {
                                    title: 'Pumpe P-102 Info',
                                    content: 'Sjekk for lekkasjer rundt pakninger. Oljenivå skal være synlig i sikteglass. Rapporter om unormal temperatur.'
                                }
                            }
                        ],
                        'Ventiler': [
                            {
                                id: 3,
                                description: 'Kontroller ventil V-201',
                                completed: false,
                                info: {
                                    title: 'Ventil V-201 Info',
                                    content: 'Verifiser at ventilen opererer fritt. Sjekk for lekkasjer rundt spindel. Noter eventuell korrosjon.'
                                }
                            }
                        ]
                    }
                    // Add more areas as needed
                };

                setTasks(dummyTasks);
                localStorage.setItem('osebergTasks', JSON.stringify(dummyTasks));
            }, []);

            const areasOppe = ['W21', 'P21/Mezz', 'C22', 'P22', 'P23/Mezz', 'Boligkvarter'];
            const areasNede = ['C12', 'W13', 'P12', 'W12', 'W11', 'P11/Mezz', 'C11', 'Z10'];

            const selectArea = (area) => {
                setSelectedArea(area);
                setCurrentScreen('tasks');
            };

            const toggleTask = (area, category, id) => {
                const newTasks = {
                    ...tasks,
                    [area]: {
                        ...tasks[area],
                        [category]: tasks[area][category].map(task =>
                            task.id === id ? { ...task, completed: !task.completed } : task
                        )
                    }
                };
                setTasks(newTasks);
                localStorage.setItem('osebergTasks', JSON.stringify(newTasks));
            };

            const showTaskInfo = (info) => {
                setModalContent(info);
                setIsModalOpen(true);
            };

            const resetTasks = (area) => {
                const newTasks = {
                    ...tasks,
                    [area]: Object.fromEntries(
                        Object.entries(tasks[area]).map(([category, categoryTasks]) => [
                            category,
                            categoryTasks.map(task => ({ ...task, completed: false }))
                        ])
                    )
                };
                setTasks(newTasks);
                localStorage.setItem('osebergTasks', JSON.stringify(newTasks));
            };

            const resetAllTasks = () => {
                if (!tasks) return;
                
                const newTasks = Object.fromEntries(
                    Object.entries(tasks).map(([area, areaTasks]) => [
                        area,
                        Object.fromEntries(
                            Object.entries(areaTasks).map(([category, categoryTasks]) => [
                                category,
                                categoryTasks.map(task => ({ ...task, completed: false }))
                            ])
                        )
                    ])
                );
                setTasks(newTasks);
                localStorage.setItem('osebergTasks', JSON.stringify(newTasks));
            };

            if (!tasks) {
                return React.createElement('div', { 
                    className: 'flex items-center justify-center min-h-screen' 
                }, 'Laster...');
            }

            // Welcome screen
            if (currentScreen === 'welcome') {
                return React.createElement('div', { className: 'p-4 max-w-md mx-auto' },
                    React.createElement('div', { className: 'space-y-6' },
                        React.createElement('h1', { className: 'text-2xl font-bold' }, 'Oseberg Sør'),
                        React.createElement('div', { className: 'p-4 bg-blue-100 rounded-lg' },
                            React.createElement('h2', { className: 'text-xl font-semibold mb-2 text-blue-800' }, 'Operatørrunde Oppe'),
                            React.createElement('div', { className: 'grid grid-cols-2 gap-2' },
                                ...areasOppe.map(area =>
                                    React.createElement(Button, {
                                        key: area,
                                        onClick: () => selectArea(area),
                                        className: 'bg-blue-600 hover:bg-blue-700'
                                    }, area)
                                )
                            )
                        ),
                        React.createElement('div', { className: 'p-4 bg-green-100 rounded-lg' },
                            React.createElement('h2', { className: 'text-xl font-semibold mb-2 text-green-800' }, 'Operatørrunde Nede'),
                            React.createElement('div', { className: 'grid grid-cols-2 gap-2' },
                                ...areasNede.map(area =>
                                    React.createElement(Button, {
                                        key: area,
                                        onClick: () => selectArea(area),
                                        className: 'bg-green-600 hover:bg-green-700'
                                    }, area)
                                )
                            )
                        ),
                        React.createElement(Button, {
                            onClick: resetAllTasks,
                            className: 'w-full bg-red-600 hover:bg-red-700 mb-4'
                        }, 'Tilbakestill alle oppgaver')
                    )
                );
            }

            // Tasks screen
            return React.createElement('div', { className: 'p-4 max-w-md mx-auto' },
                React.createElement('div', { className: 'space-y-4' },
                    React.createElement('div', { className: 'flex items-center justify-between' },
                        React.createElement(Button, {
                            onClick: () => setCurrentScreen('welcome'),
                            className: 'bg-gray-500 hover:bg-gray-600'
                        }, 'Tilbake'),
                        React.createElement('h2', { className: 'text-xl font-semibold' }, 
                            `Oppgaver for ${selectedArea}`
                        )
                    ),
                    tasks[selectedArea] && Object.entries(tasks[selectedArea]).map(([category, categoryTasks]) =>
                        React.createElement('div', { key: category, className: 'bg-white rounded-lg p-4 shadow' },
                            React.createElement('h3', { className: 'text-lg font-semibold mb-2' }, category),
                            categoryTasks.map(task =>
                                React.createElement(Checkbox, {
                                    key: task.id,
                                    id: `${selectedArea}-${category}-${task.id}`,
                                    checked: task.completed,
                                    onChange: () => toggleTask(selectedArea, category, task.id),
                                    label: task.description,
                                    hasInfo: !!task.info,
                                    onInfoClick: () => showTaskInfo(task.info)
                                })
                            )
                        )
                    ),
                    React.createElement(Button, {
                        onClick: () => resetTasks(selectedArea),
                        className: 'w-full bg-yellow-600 hover:bg-yellow-700'
                    }, `Tilbakestill oppgaver for ${selectedArea}`)
                ),
                React.createElement(Modal, {
                    isOpen: isModalOpen,
                    onClose: () => setIsModalOpen(false),
                    title: modalContent.title,
                    content: modalContent.content
                })
            );
        };

        ReactDOM.render(
            React.createElement(App),
            document.getElementById('root')
        );
    </script>
</body>
</html>
